<?xml version="1.0" encoding="utf-8"?>
<DataSchemaModel FileFormatVersion="1.2" SchemaVersion="2.9" DspName="Microsoft.Data.Tools.Schema.Sql.Sql150DatabaseSchemaProvider" CollationLcid="1033" CollationCaseSensitive="False" xmlns="http://schemas.microsoft.com/sqlserver/dac/Serialization/2012/02">
	<Header>
		<CustomData Category="AnsiNulls">
			<Metadata Name="AnsiNulls" Value="True" />
		</CustomData>
		<CustomData Category="QuotedIdentifier">
			<Metadata Name="QuotedIdentifier" Value="True" />
		</CustomData>
		<CustomData Category="CompatibilityMode">
			<Metadata Name="CompatibilityMode" Value="150" />
		</CustomData>
		<CustomData Category="Reference" Type="Assembly">
			<Metadata Name="LogicalName" Value="Database1.dll" />
			<Metadata Name="FileName" Value="C:\USERS\PAPAI\ONEDRIVE\DESKTOP\RETAILPULSE_DW\RETAILPULSE_DW_CI\RETAILPULSE_DW\OBJ\RELEASE\DATABASE1.DLL" />
			<Metadata Name="AssemblyName" Value="Database1" />
			<Metadata Name="PermissionSet" Value="SAFE" />
			<Metadata Name="Owner" Value="" />
			<Metadata Name="GenerateSqlClrDdl" Value="True" />
			<Metadata Name="IsVisible" Value="True" />
			<Metadata Name="IsModelAware" Value="True" />
			<Metadata Name="SkipCreationIfEmpty" Value="True" />
			<Metadata Name="AssemblySymbolsName" Value="C:\Users\papai\OneDrive\Desktop\RetailPulse_DW\RetailPulse_DW_CI\RetailPulse_DW\obj\Release\Database1.pdb" />
		</CustomData>
		<CustomData Category="SqlCmdVariables" Type="SqlCmdVariable" />
	</Header>
	<Model>
		<Element Type="SqlDatabaseOptions">
			<Property Name="Collation" Value="SQL_Latin1_General_CP1_CI_AS" />
			<Property Name="IsAnsiNullDefaultOn" Value="True" />
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Property Name="IsAnsiWarningsOn" Value="True" />
			<Property Name="IsArithAbortOn" Value="True" />
			<Property Name="IsConcatNullYieldsNullOn" Value="True" />
			<Property Name="IsTornPageProtectionOn" Value="False" />
			<Property Name="IsFullTextEnabled" Value="True" />
			<Property Name="PageVerifyMode" Value="3" />
			<Property Name="DefaultLanguage" Value="" />
			<Property Name="DefaultFullTextLanguage" Value="" />
			<Property Name="QueryStoreStaleQueryThreshold" Value="367" />
			<Relationship Name="DefaultFilegroup">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[PRIMARY]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[stage].[Products]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[stage].[Products].[InsertedAt]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="3" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[raw].[Products]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[raw].[Products].[InsertedAt]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="4" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[stage].[Transactions]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[stage].[Transactions].[InsertedAt]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="5" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[TransactionsFact]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[prod].[TransactionsFact].[InsertedAt]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="6" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[('9999-12-31')]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[UsersDim]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[prod].[UsersDim].[ExpirationDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="7" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[((1))]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[UsersDim]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[prod].[UsersDim].[IsCurrent]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="8" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[SubTerritoriesDim]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[prod].[SubTerritoriesDim].[CreatedAt]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="9" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[TerritoriesDim]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[prod].[TerritoriesDim].[CreatedAt]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="10" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[config].[CountryInfo]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[config].[CountryInfo].[InsertedAt]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="11" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[ExchangeRatesDim]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[prod].[ExchangeRatesDim].[EffectiveDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="12" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[('9999-12-31')]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[ExchangeRatesDim]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[prod].[ExchangeRatesDim].[ExpirationDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="13" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[((1))]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[ExchangeRatesDim]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[prod].[ExchangeRatesDim].[IsCurrent]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="14" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[config].[Datasets]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[config].[Datasets].[CreatedAt]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="15" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[('https://randomuser.me/api/')]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[raw].[Users]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[raw].[Users].[Source]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="16" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[raw].[Users]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[raw].[Users].[InsertedAt]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="17" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[raw].[Transactions]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[raw].[Transactions].[InsertedAt]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="18" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[stage].[SubTerritories]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[stage].[SubTerritories].[CreatedAt]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="19" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[stage].[Territories]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[stage].[Territories].[CreatedAt]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="20" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[('UNKNOWN')]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[stage].[Users]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[stage].[Users].[Source]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="21" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[stage].[Users]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[stage].[Users].[InsertedAt]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="22" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[ProductsDim]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[prod].[ProductsDim].[EffectiveDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="23" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[('9999-12-31')]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[ProductsDim]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[prod].[ProductsDim].[ExpirationDate]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="24" />
		</Element>
		<Element Type="SqlDefaultConstraint">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[((1))]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[ProductsDim]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[prod].[ProductsDim].[IsCurrent]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="25" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[stage].[Products].[ProductId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[stage].[Products]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="26" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[raw].[Products].[ProductId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[raw].[Products]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="27" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[stage].[Transactions].[TransactionId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[stage].[Transactions]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="28" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[prod].[TransactionsFact].[TransactionId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[TransactionsFact]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="29" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[prod].[UsersDim].[UserId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[UsersDim]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="30" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[prod].[SubTerritoriesDim].[SubTerritoryId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[SubTerritoriesDim]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="31" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[prod].[TerritoriesDim].[TerritoryId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[TerritoriesDim]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="32" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[config].[CountryInfo].[Id]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[config].[CountryInfo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="33" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[prod].[ExchangeRatesDim].[ExchangeRateId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[ExchangeRatesDim]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="34" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[prod].[DateDim].[DateKey]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[DateDim]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="35" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[config].[HashColumns].[Id]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[config].[HashColumns]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="36" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[config].[Datasets].[Id]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[config].[Datasets]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="37" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[raw].[Users].[UserId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[raw].[Users]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="38" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[stage].[SubTerritories].[SubTerritoryId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[stage].[SubTerritories]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="39" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[stage].[Territories].[TerritoryId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[stage].[Territories]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="40" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[stage].[Users].[UserId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[stage].[Users]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="41" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[prod].[ProductsDim].[ProductId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[ProductsDim]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="42" />
		</Element>
		<Element Type="SqlSchema" Name="[config]">
			<Relationship Name="Authorizer">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[config].[CountryInfo]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[config].[CountryInfo].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[config].[CountryInfo].[CountryName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[config].[CountryInfo].[Currency]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="10" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[config].[CountryInfo].[CurrencySymbol]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[config].[CountryInfo].[InsertedAt]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="11" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[config]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="33" />
		</Element>
		<Element Type="SqlTable" Name="[config].[Datasets]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[config].[Datasets].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[config].[Datasets].[Dataset]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[config].[Datasets].[DatasetSource]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[config].[Datasets].[SourceRefreshType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[config].[Datasets].[LoadTable]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[config].[Datasets].[ProcessingTable]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[config].[Datasets].[FinalTable]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[config].[Datasets].[CreatedAt]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="15" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[config]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="37" />
		</Element>
		<Element Type="SqlTable" Name="[config].[HashColumns]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[config].[HashColumns].[Id]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[config].[HashColumns].[DatasetId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[config].[HashColumns].[ColumnName]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[config].[HashColumns].[HashString]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[config].[HashColumns].[HashOrder]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[config]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="36" />
		</Element>
		<Element Type="SqlProcedure" Name="[config].[HashTableEntries]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
    SET NOCOUNT ON;

    BEGIN TRY
        
        DECLARE @sqlHashData NVARCHAR(MAX);
        DECLARE @HashString NVARCHAR(MAX);

        -- Get the target processing table from the Datasets config
        DECLARE @TableAndSchema NVARCHAR(MAX) = (SELECT d.ProcessingTable FROM config.Datasets d WHERE d.Id = @DataSourceID)

        IF @TableAndSchema IS NULL
        BEGIN
            RAISERROR('No processing table found for DataSourceID %d.', 16, 1, @DataSourceID);
            RETURN;
        END;

        -- Construct the hash string from the HashColumns config
        WITH HC AS (
            SELECT TOP 100 PERCENT HashString
            FROM config.HashColumns
            WHERE DatasetId = @DataSourceID
            ORDER BY HashOrder, Id
        )
        SELECT @HashString = STRING_AGG(HashString, ', ''|'' , ')
        FROM HC;

        IF @HashString IS NULL
        BEGIN
            RAISERROR('No hash columns found for DataSourceID %d.', 16, 1, @DataSourceID);
            RETURN;
        END

        -- Prepare dynamic SQL
        SET @sqlHashData = '
            UPDATE ' + @TableAndSchema + '
            SET HASHDATA = UPPER(CONCAT(' + @HashString + '));

            UPDATE ' + @TableAndSchema + '
            SET BUSINESSKEYHASH = HASHBYTES(''SHA2_512'', HASHDATA);
        ';

        -- Execute the dynamic SQL
        EXEC sp_executesql @sqlHashData;

    END TRY
    BEGIN CATCH
        DECLARE @ErrorMessage NVARCHAR(4000) = ERROR_MESSAGE();
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();
        DECLARE @ErrorState INT = ERROR_STATE();

        RAISERROR('Error in config.HashTableEntries: %s', @ErrorSeverity, @ErrorState, @ErrorMessage);
    END CATCH
END;]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[config].[Datasets]" />
				</Entry>
				<Entry>
					<References Name="[config].[Datasets].[ProcessingTable]" />
				</Entry>
				<Entry>
					<References Name="[config].[Datasets].[Id]" />
				</Entry>
				<Entry>
					<References Name="[config].[HashTableEntries].[@DataSourceID]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[config].[HashColumns]" />
				</Entry>
				<Entry>
					<References Name="[config].[HashColumns].[HashString]" />
				</Entry>
				<Entry>
					<References Name="[config].[HashColumns].[DatasetId]" />
				</Entry>
				<Entry>
					<References Name="[config].[HashColumns].[HashOrder]" />
				</Entry>
				<Entry>
					<References Name="[config].[HashColumns].[Id]" />
				</Entry>
				<Entry />
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[config].[HashTableEntries].[CTE1].[HC]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[config].[HashTableEntries].[CTE1].[HC].[HashString]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[config].[HashColumns].[HashString]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[config].[HashTableEntries].[@DataSourceID]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[config]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="1830" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE   PROCEDURE config.HashTableEntries&#xD;&#xA;    @DataSourceID INT&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[config].[IngestCountryInfo]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
    SET NOCOUNT ON;

    IF OBJECT_ID('[config].[CountryInfo]', 'U') IS NULL
    BEGIN
        CREATE TABLE [config].[CountryInfo]
		(
			Id INT IDENTITY(1,1) PRIMARY KEY,
			CountryName NVARCHAR(255),
			Currency NVARCHAR(10),
			CurrencySymbol NVARCHAR(10),
			InsertedAt DATETIME DEFAULT GETDATE()
		);
    END

    -- Insert or ignore if already exists (optional logic depending on uniqueness)
    INSERT INTO [config].[CountryInfo] (
		CountryName,
		Currency,
		CurrencySymbol
	)
	VALUES (
		@CountryName,
		@Currency,
		@CurrencySymbol
	)
END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[config].[CountryInfo]" />
				</Entry>
				<Entry>
					<References Name="[config].[CountryInfo].[Id]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[config].[CountryInfo].[CountryName]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[config].[CountryInfo].[Currency]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[config].[CountryInfo].[CurrencySymbol]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[config].[CountryInfo].[InsertedAt]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetime]" />
				</Entry>
				<Entry>
					<References Name="[config].[CountryInfo]" />
				</Entry>
				<Entry>
					<References Name="[config].[CountryInfo].[CountryName]" />
				</Entry>
				<Entry>
					<References Name="[config].[CountryInfo].[Currency]" />
				</Entry>
				<Entry>
					<References Name="[config].[CountryInfo].[CurrencySymbol]" />
				</Entry>
				<Entry>
					<References Name="[config].[IngestCountryInfo].[@CountryName]" />
				</Entry>
				<Entry>
					<References Name="[config].[IngestCountryInfo].[@Currency]" />
				</Entry>
				<Entry>
					<References Name="[config].[IngestCountryInfo].[@CurrencySymbol]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[config].[IngestCountryInfo].[@CountryName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[config].[IngestCountryInfo].[@Currency]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="10" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[config].[IngestCountryInfo].[@CurrencySymbol]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[config]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="729" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [config].[IngestCountryInfo]&#xD;&#xA;    @CountryName NVARCHAR(255),&#xD;&#xA;    @Currency NVARCHAR(10),&#xD;&#xA;    @CurrencySymbol NVARCHAR(100)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlSchema" Name="[prod]">
			<Relationship Name="Authorizer">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[prod].[DateDim]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[DateDim].[DateKey]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[DateDim].[FullDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[date]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[DateDim].[Day]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[DateDim].[Month]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[DateDim].[MonthName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="20" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[DateDim].[Year]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[DateDim].[Quarter]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[DateDim].[DayOfWeek]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[DateDim].[DayName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="20" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[DateDim].[WeekOfYear]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[DateDim].[ISOWeek]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[DateDim].[IsWeekend]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[DateDim].[IsLeapYear]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[prod]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="35" />
		</Element>
		<Element Type="SqlTable" Name="[prod].[ExchangeRatesDim]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[ExchangeRatesDim].[ExchangeRateId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[ExchangeRatesDim].[Country]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[ExchangeRatesDim].[Currency]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="3" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[ExchangeRatesDim].[RateToEUR]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="6" />
									<Property Name="Precision" Value="18" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[ExchangeRatesDim].[EffectiveDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[date]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="12" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[ExchangeRatesDim].[ExpirationDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[date]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="13" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[ExchangeRatesDim].[IsCurrent]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="14" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[prod]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="34" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[prod].[FK_SubTerritories_Territories]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[prod].[SubTerritoriesDim].[TerritoryId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[SubTerritoriesDim]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[prod].[TerritoriesDim].[TerritoryId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[prod].[TerritoriesDim]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="43" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[prod].[FK_TransactionsFact_Date]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[prod].[TransactionsFact].[DateKey]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[TransactionsFact]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[prod].[DateDim].[DateKey]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[prod].[DateDim]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="44" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[prod].[FK_TransactionsFact_ExchangeRate]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[prod].[TransactionsFact].[ExchangeRateId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[TransactionsFact]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[prod].[ExchangeRatesDim].[ExchangeRateId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[prod].[ExchangeRatesDim]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="45" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[prod].[FK_TransactionsFact_Product]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[prod].[TransactionsFact].[ProductId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[TransactionsFact]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[prod].[ProductsDim].[ProductId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[prod].[ProductsDim]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="46" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[prod].[FK_TransactionsFact_User]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[prod].[TransactionsFact].[UserId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[TransactionsFact]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[prod].[UsersDim].[UserId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[prod].[UsersDim]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="47" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[prod].[FK_UsersDim_SubTerritories]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[prod].[UsersDim].[SubTerritoryId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[prod].[UsersDim]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[prod].[SubTerritoriesDim].[SubTerritoryId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[prod].[SubTerritoriesDim]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="48" />
		</Element>
		<Element Type="SqlProcedure" Name="[prod].[GenerateDateDim]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
    SET NOCOUNT ON;

    DECLARE @CurrentDate DATE = @StartDate;

    WHILE @CurrentDate <= @EndDate
    BEGIN
        INSERT INTO prod.DateDim (
            DateKey, FullDate, Day, Month, MonthName, Year, Quarter,
            DayOfWeek, DayName, WeekOfYear, ISOWeek, IsWeekend, IsLeapYear
        )
        SELECT
            CONVERT(INT, FORMAT(@CurrentDate, 'yyyyMMdd')),
            @CurrentDate,
            DAY(@CurrentDate),
            MONTH(@CurrentDate),
            DATENAME(MONTH, @CurrentDate),
            YEAR(@CurrentDate),
            DATEPART(QUARTER, @CurrentDate),
            DATEPART(WEEKDAY, @CurrentDate),
            DATENAME(WEEKDAY, @CurrentDate),
            DATEPART(WEEK, @CurrentDate),
            DATEPART(ISO_WEEK, @CurrentDate),
            CASE WHEN DATEPART(WEEKDAY, @CurrentDate) IN (1, 7) THEN 1 ELSE 0 END,
            CASE WHEN (YEAR(@CurrentDate) % 4 = 0 AND YEAR(@CurrentDate) % 100 <> 0) OR (YEAR(@CurrentDate) % 400 = 0) THEN 1 ELSE 0 END;

        SET @CurrentDate = DATEADD(DAY, 1, @CurrentDate);
    END
END;]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[date]" />
				</Entry>
				<Entry>
					<References Name="[prod].[GenerateDateDim].[@StartDate]" />
				</Entry>
				<Entry>
					<References Name="[prod].[GenerateDateDim].[@EndDate]" />
				</Entry>
				<Entry>
					<References Name="[prod].[DateDim]" />
				</Entry>
				<Entry>
					<References Name="[prod].[DateDim].[DateKey]" />
				</Entry>
				<Entry>
					<References Name="[prod].[DateDim].[FullDate]" />
				</Entry>
				<Entry>
					<References Name="[prod].[DateDim].[Day]" />
				</Entry>
				<Entry>
					<References Name="[prod].[DateDim].[Month]" />
				</Entry>
				<Entry>
					<References Name="[prod].[DateDim].[MonthName]" />
				</Entry>
				<Entry>
					<References Name="[prod].[DateDim].[Year]" />
				</Entry>
				<Entry>
					<References Name="[prod].[DateDim].[Quarter]" />
				</Entry>
				<Entry>
					<References Name="[prod].[DateDim].[DayOfWeek]" />
				</Entry>
				<Entry>
					<References Name="[prod].[DateDim].[DayName]" />
				</Entry>
				<Entry>
					<References Name="[prod].[DateDim].[WeekOfYear]" />
				</Entry>
				<Entry>
					<References Name="[prod].[DateDim].[ISOWeek]" />
				</Entry>
				<Entry>
					<References Name="[prod].[DateDim].[IsWeekend]" />
				</Entry>
				<Entry>
					<References Name="[prod].[DateDim].[IsLeapYear]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[prod].[GenerateDateDim].[@StartDate]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[date]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[prod].[GenerateDateDim].[@EndDate]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[date]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[prod]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="1177" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [prod].[GenerateDateDim]&#xD;&#xA;    @StartDate DATE,&#xD;&#xA;    @EndDate DATE&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[prod].[InsertTransactionsFact]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
    SET NOCOUNT ON;

    BEGIN TRY
        -- If the table does not exist, create it
        IF NOT EXISTS (
            SELECT 1
            FROM INFORMATION_SCHEMA.TABLES
            WHERE TABLE_SCHEMA = 'prod' AND TABLE_NAME = 'TransactionsFact'
        )
        BEGIN
            EXEC('
                CREATE TABLE prod.TransactionsFact (
                    TransactionId INT IDENTITY(1,1) PRIMARY KEY,
                    TransactionBK NVARCHAR(50) NOT NULL,
                    UserId INT NOT NULL,
                    ProductId INT NOT NULL,
                    ExchangeRateId INT NOT NULL,
                    DateKey INT NOT NULL,
                    Currency NVARCHAR(3) NOT NULL,
                    ProductLocalPrice DECIMAL(18, 2) NOT NULL,
                    ProductStandardizedPrice DECIMAL(18, 2) NOT NULL,
                    CartLocalPrice DECIMAL(18, 2) NOT NULL,
                    CartStandardizedPrice DECIMAL(18, 2) NOT NULL,
                    InsertedAt DATETIME DEFAULT GETDATE(),

                    CONSTRAINT FK_TransactionsFact_User FOREIGN KEY (UserId) REFERENCES prod.UsersDim(UserId),
                    CONSTRAINT FK_TransactionsFact_Product FOREIGN KEY (ProductId) REFERENCES prod.ProductsDim(ProductId),
                    CONSTRAINT FK_TransactionsFact_ExchangeRate FOREIGN KEY (ExchangeRateId) REFERENCES prod.ExchangeRatesDim(ExchangeRateId),
                    CONSTRAINT FK_TransactionsFact_Date FOREIGN KEY (DateKey) REFERENCES prod.DateDim(DateKey)
                );
            ');
        END

        -- Insert data into prod.TransactionsFact
        INSERT INTO prod.TransactionsFact (
            TransactionBK,
            UserId,
            ProductId,
            ExchangeRateId,
            DateKey,
            Currency,
            ProductLocalPrice,
            ProductStandardizedPrice,
            CartLocalPrice,
            CartStandardizedPrice,
            InsertedAt
        )
        SELECT
            TransactionBK,
            UserId,
            ProductId,
            ExchangeRateId,
            DateKey,
            Currency,
            ProductLocalPrice,
            ProductStandardizedPrice,
            CartLocalPrice,
            CartStandardizedPrice,
            InsertedAt
        FROM stage.Transactions;

    END TRY
    BEGIN CATCH
        DECLARE @ErrorMessage NVARCHAR(4000) = ERROR_MESSAGE();
        RAISERROR('Error in InsertTransactionsFact: %s', 16, 1, @ErrorMessage);
    END CATCH
END;]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[prod].[TransactionsFact]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TransactionsFact].[TransactionBK]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TransactionsFact].[UserId]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TransactionsFact].[ProductId]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TransactionsFact].[ExchangeRateId]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TransactionsFact].[DateKey]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TransactionsFact].[Currency]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TransactionsFact].[ProductLocalPrice]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TransactionsFact].[ProductStandardizedPrice]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TransactionsFact].[CartLocalPrice]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TransactionsFact].[CartStandardizedPrice]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TransactionsFact].[InsertedAt]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions].[TransactionBK]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions].[UserId]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions].[ProductId]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions].[ExchangeRateId]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions].[DateKey]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions].[Currency]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions].[ProductLocalPrice]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions].[ProductStandardizedPrice]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions].[CartLocalPrice]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions].[CartStandardizedPrice]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions].[InsertedAt]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[prod]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="2610" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE   PROCEDURE prod.InsertTransactionsFact&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[prod].[MergeSubTerritoriesDim]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
    SET NOCOUNT ON;

    BEGIN TRY
        BEGIN TRANSACTION;

        MERGE INTO prod.SubTerritoriesDim AS target
        USING (
            SELECT 
                b.TerritoryId,
                a.City,
                a.StreetName,
                a.Latitude,
                a.Longitude,
                a.CreatedAt,
                a.BUSINESSKEYHASH,
                a.HASHDATA
            FROM stage.SubTerritories a
            INNER JOIN stage.Territories t ON a.TerritoryId = t.TerritoryId
            INNER JOIN prod.TerritoriesDim b ON t.BUSINESSKEYHASH = b.BUSINESSKEYHASH
        ) AS source
        ON target.BUSINESSKEYHASH = source.BUSINESSKEYHASH

        WHEN NOT MATCHED BY TARGET THEN
            INSERT (TerritoryId, City, StreetName, Latitude, Longitude, CreatedAt, BUSINESSKEYHASH, HASHDATA)
            VALUES (source.TerritoryId, source.City, source.StreetName, source.Latitude, source.Longitude, GETDATE(), source.BUSINESSKEYHASH, source.HASHDATA);

        -- No update on match, no delete

        COMMIT TRANSACTION;
    END TRY
    BEGIN CATCH
        IF @@TRANCOUNT > 0
            ROLLBACK TRANSACTION;

        DECLARE @ErrorMessage NVARCHAR(4000) = ERROR_MESSAGE();
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();
        DECLARE @ErrorState INT = ERROR_STATE();

        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);
    END CATCH
END;]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Territories]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[TerritoryId]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Territories].[TerritoryId]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TerritoriesDim]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Territories].[BUSINESSKEYHASH]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TerritoriesDim].[BUSINESSKEYHASH]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TerritoriesDim].[TerritoryId]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[City]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[StreetName]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[Latitude]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[Longitude]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[CreatedAt]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[BUSINESSKEYHASH]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[HASHDATA]" />
				</Entry>
				<Entry>
					<References Name="[prod].[SubTerritoriesDim]" />
				</Entry>
				<Entry>
					<References Name="[prod].[SubTerritoriesDim].[BUSINESSKEYHASH]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[BUSINESSKEYHASH]" />
				</Entry>
				<Entry>
					<References Name="[prod].[SubTerritoriesDim].[TerritoryId]" />
				</Entry>
				<Entry>
					<References Name="[prod].[SubTerritoriesDim].[City]" />
				</Entry>
				<Entry>
					<References Name="[prod].[SubTerritoriesDim].[StreetName]" />
				</Entry>
				<Entry>
					<References Name="[prod].[SubTerritoriesDim].[Latitude]" />
				</Entry>
				<Entry>
					<References Name="[prod].[SubTerritoriesDim].[Longitude]" />
				</Entry>
				<Entry>
					<References Name="[prod].[SubTerritoriesDim].[CreatedAt]" />
				</Entry>
				<Entry>
					<References Name="[prod].[SubTerritoriesDim].[BUSINESSKEYHASH]" />
				</Entry>
				<Entry>
					<References Name="[prod].[SubTerritoriesDim].[HASHDATA]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TerritoriesDim].[TerritoryId]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[City]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[StreetName]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[Latitude]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[Longitude]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[BUSINESSKEYHASH]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[HASHDATA]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[prod]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="1490" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE   PROCEDURE [prod].[MergeSubTerritoriesDim]&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[prod].[MergeTerritoriesDim]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
    SET NOCOUNT ON;

    BEGIN TRY
        BEGIN TRANSACTION;

        MERGE INTO prod.TerritoriesDim AS target
        USING (
            SELECT Country, State, BUSINESSKEYHASH, HASHDATA
            FROM stage.Territories
        ) AS source
        ON target.BUSINESSKEYHASH = source.BUSINESSKEYHASH

        WHEN NOT MATCHED BY TARGET THEN
            INSERT (Country, State, CreatedAt, BUSINESSKEYHASH, HASHDATA)
            VALUES (source.Country, source.State, GETDATE(), source.BUSINESSKEYHASH, source.HASHDATA);

        -- No update on match, no delete

        COMMIT TRANSACTION;
    END TRY
    BEGIN CATCH
        IF @@TRANCOUNT > 0
            ROLLBACK TRANSACTION;

        DECLARE @ErrorMessage NVARCHAR(4000) = ERROR_MESSAGE();
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();
        DECLARE @ErrorState INT = ERROR_STATE();

        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);
    END CATCH
END;]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Territories]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Territories].[Country]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Territories].[State]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Territories].[BUSINESSKEYHASH]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Territories].[HASHDATA]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TerritoriesDim]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TerritoriesDim].[BUSINESSKEYHASH]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Territories].[BUSINESSKEYHASH]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TerritoriesDim].[Country]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TerritoriesDim].[State]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TerritoriesDim].[CreatedAt]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TerritoriesDim].[BUSINESSKEYHASH]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TerritoriesDim].[HASHDATA]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Territories].[Country]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Territories].[State]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Territories].[BUSINESSKEYHASH]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Territories].[HASHDATA]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[prod]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="1022" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE   PROCEDURE [prod].[MergeTerritoriesDim]&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlTable" Name="[prod].[ProductsDim]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[ProductsDim].[ProductId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[ProductsDim].[Name]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[ProductsDim].[Description]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[ProductsDim].[Color]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[ProductsDim].[Brand]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[ProductsDim].[Category]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[ProductsDim].[Gender]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[ProductsDim].[Price]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="2" />
									<Property Name="Precision" Value="10" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[ProductsDim].[BUSINESSKEYHASH]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="6000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varbinary]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[ProductsDim].[HASHDATA]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[ProductsDim].[EffectiveDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="23" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[ProductsDim].[ExpirationDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="24" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[ProductsDim].[IsCurrent]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="25" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[prod]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="42" />
		</Element>
		<Element Type="SqlTable" Name="[prod].[SubTerritoriesDim]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[SubTerritoriesDim].[SubTerritoryId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[SubTerritoriesDim].[TerritoryId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[SubTerritoriesDim].[City]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[SubTerritoriesDim].[StreetName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[SubTerritoriesDim].[Latitude]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="6" />
									<Property Name="Precision" Value="9" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[SubTerritoriesDim].[Longitude]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="6" />
									<Property Name="Precision" Value="9" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[SubTerritoriesDim].[CreatedAt]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="9" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[SubTerritoriesDim].[BUSINESSKEYHASH]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="6000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varbinary]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[SubTerritoriesDim].[HASHDATA]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[prod]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="31" />
			<AttachedAnnotation Disambiguator="43" />
		</Element>
		<Element Type="SqlTable" Name="[prod].[TerritoriesDim]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[TerritoriesDim].[TerritoryId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[TerritoriesDim].[Country]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[TerritoriesDim].[State]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[TerritoriesDim].[CreatedAt]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="10" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[TerritoriesDim].[BUSINESSKEYHASH]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="6000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varbinary]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[TerritoriesDim].[HASHDATA]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[prod]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="32" />
		</Element>
		<Element Type="SqlTable" Name="[prod].[TransactionsFact]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[TransactionsFact].[TransactionId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[TransactionsFact].[TransactionBK]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[TransactionsFact].[UserId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[TransactionsFact].[ProductId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[TransactionsFact].[ExchangeRateId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[TransactionsFact].[DateKey]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[TransactionsFact].[Currency]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="3" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[TransactionsFact].[ProductLocalPrice]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="2" />
									<Property Name="Precision" Value="18" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[TransactionsFact].[ProductStandardizedPrice]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="2" />
									<Property Name="Precision" Value="18" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[TransactionsFact].[CartLocalPrice]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="2" />
									<Property Name="Precision" Value="18" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[TransactionsFact].[CartStandardizedPrice]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="2" />
									<Property Name="Precision" Value="18" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[TransactionsFact].[InsertedAt]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="6" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[prod]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="29" />
			<AttachedAnnotation Disambiguator="44" />
			<AttachedAnnotation Disambiguator="45" />
			<AttachedAnnotation Disambiguator="46" />
			<AttachedAnnotation Disambiguator="47" />
		</Element>
		<Element Type="SqlProcedure" Name="[prod].[UpsertExchangeRate]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
    SET NOCOUNT ON;

    DECLARE @Today DATE = CAST(GETDATE() AS DATE);

    -- Deactivate previous rows for this currency
    UPDATE prod.ExchangeRatesDim
    SET 
		IsCurrent = 0,
        ExpirationDate = @Today
    WHERE
		Country = @Country
		AND Currency = @Currency 
		AND IsCurrent = 1;

    INSERT INTO prod.ExchangeRatesDim 
	(
        Country,
		Currency,
		RateToEUR
    )
    VALUES (
        @Country,
		@Currency,
		@RateToEUR
    );
END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[date]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[date]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ExchangeRatesDim]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ExchangeRatesDim].[IsCurrent]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ExchangeRatesDim].[ExpirationDate]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ExchangeRatesDim].[Country]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UpsertExchangeRate].[@Country]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ExchangeRatesDim].[Currency]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UpsertExchangeRate].[@Currency]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ExchangeRatesDim].[RateToEUR]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UpsertExchangeRate].[@RateToEUR]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[prod].[UpsertExchangeRate].[@Country]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[prod].[UpsertExchangeRate].[@Currency]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="10" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[prod].[UpsertExchangeRate].[@RateToEUR]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="6" />
									<Property Name="Precision" Value="18" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[prod]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="623" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE   PROCEDURE [prod].[UpsertExchangeRate]&#xD;&#xA;    @Country NVARCHAR(255),&#xD;&#xA;    @Currency NVARCHAR(10),&#xD;&#xA;    @RateToEUR DECIMAL(18,6)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[prod].[UpsertProductsDim]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
    SET NOCOUNT ON;

    BEGIN TRY
        BEGIN TRANSACTION;

        -- Step 1: Expire old records if BUSINESSKEYHASH exists in both stage and prod
        UPDATE p
        SET 
            ExpirationDate = GETDATE(),
            IsCurrent = 0
        FROM prod.ProductsDim p
        INNER JOIN stage.Products s
            ON p.BUSINESSKEYHASH = s.BUSINESSKEYHASH AND p.Price <> s.Price
        WHERE p.IsCurrent = 1;

        INSERT INTO prod.ProductsDim (
            Name,
            Description,
            Color,
            Brand,
            Category,
            Gender,
            Price,
            BUSINESSKEYHASH,
            HASHDATA,
			EffectiveDate
        )
        SELECT 
            s.Name,
            s.Description,
            s.Color,
            s.Brand,
            s.Category,
            s.Gender,
            s.Price,
            s.BUSINESSKEYHASH,
            s.HASHDATA,
			InsertedAt
        FROM stage.Products s
		WHERE NOT EXISTS (
            SELECT 1
            FROM prod.ProductsDim p
            WHERE 
                p.BUSINESSKEYHASH = s.BUSINESSKEYHASH
                AND p.IsCurrent = 1
        );

        COMMIT TRANSACTION;
    END TRY
    BEGIN CATCH
        ROLLBACK TRANSACTION;
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();
        DECLARE @ErrorState INT = ERROR_STATE();
        RAISERROR (@ErrorMessage, @ErrorSeverity, @ErrorState);
    END CATCH
END;]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim].[BUSINESSKEYHASH]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[BUSINESSKEYHASH]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim].[Price]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Price]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim].[ExpirationDate]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim].[IsCurrent]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim].[IsCurrent]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim].[Name]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim].[Description]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim].[Color]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim].[Brand]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim].[Category]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim].[Gender]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim].[Price]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim].[BUSINESSKEYHASH]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim].[HASHDATA]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim].[EffectiveDate]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Name]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Description]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Color]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Brand]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Category]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Gender]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Price]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[BUSINESSKEYHASH]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[HASHDATA]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[InsertedAt]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim].[BUSINESSKEYHASH]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[BUSINESSKEYHASH]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim].[IsCurrent]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[prod]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="1600" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE   PROCEDURE [prod].[UpsertProductsDim]&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[prod].[UpsertUsersDim]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
    SET NOCOUNT ON;

    BEGIN TRY
        BEGIN TRANSACTION;

        -- Materialize the CTE as a temp table
        IF OBJECT_ID('tempdb..#UsersWithProdTerritory') IS NOT NULL
            DROP TABLE #UsersWithProdSubTerritory;

        SELECT 
            su.*,
            std.SubTerritoryId AS ProdSubTerritoryId
        INTO #UsersWithProdSubTerritory
        FROM 
            stage.Users su
        INNER JOIN stage.SubTerritories st
            ON su.SubTerritoryId = st.SubTerritoryId
		INNER JOIN prod.SubTerritoriesDim std
			ON st.City = std.City
			AND st.StreetName = std.StreetName
			AND st.Latitude = std.Latitude
			AND st.Longitude = std.Longitude
		
		-- Step 1: Expire old records where Email has changed
        UPDATE d
        SET 
            d.ExpirationDate = s.InsertedAt,
            d.IsCurrent = 0
        FROM prod.UsersDim d
        INNER JOIN #UsersWithProdSubTerritory s 
			ON d.BUSINESSKEYHASH = s.BUSINESSKEYHASH
        WHERE 
            d.IsCurrent = 1
            AND ISNULL(d.Email, '') <> ISNULL(s.Email, '');

        -- Step 2: Insert new or changed records
        INSERT INTO prod.UsersDim (
            Source, 
			Gender,
			FullName,
			FirstName,
			LastName,
			Email,
			SubTerritoryId,
            BUSINESSKEYHASH,
			HASHDATA,
            EffectiveDate,
			ExpirationDate,
			IsCurrent
        )
        SELECT 
            s.Source,
            s.Gender,
            s.FullName,
            s.FirstName,
            s.LastName,
            s.Email,
            s.ProdSubTerritoryId,
            s.BUSINESSKEYHASH,
            s.HASHDATA,
            s.InsertedAt AS EffectiveDate,
            '9999-12-31' AS ExpirationDate,
            1 AS IsCurrent
        FROM #UsersWithProdSubTerritory s
        LEFT JOIN prod.UsersDim d
            ON s.BUSINESSKEYHASH = d.BUSINESSKEYHASH 
			AND d.IsCurrent = 1
        WHERE 
            d.UserId IS NULL 
			OR ISNULL(d.Email, '') <> ISNULL(s.Email, '');

        COMMIT TRANSACTION;
    END TRY
    BEGIN CATCH
        ROLLBACK TRANSACTION;

        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();
        DECLARE @ErrorState INT = ERROR_STATE();

        RAISERROR (@ErrorMessage, @ErrorSeverity, @ErrorState);
    END CATCH
END;]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Users]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Users].[SubTerritoryId]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[SubTerritoryId]" />
				</Entry>
				<Entry>
					<References Name="[prod].[SubTerritoriesDim]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[City]" />
				</Entry>
				<Entry>
					<References Name="[prod].[SubTerritoriesDim].[City]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[StreetName]" />
				</Entry>
				<Entry>
					<References Name="[prod].[SubTerritoriesDim].[StreetName]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[Latitude]" />
				</Entry>
				<Entry>
					<References Name="[prod].[SubTerritoriesDim].[Latitude]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[Longitude]" />
				</Entry>
				<Entry>
					<References Name="[prod].[SubTerritoriesDim].[Longitude]" />
				</Entry>
				<Entry>
					<References Name="[prod].[SubTerritoriesDim].[SubTerritoryId]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim].[BUSINESSKEYHASH]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[BUSINESSKEYHASH]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim].[ExpirationDate]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[InsertedAt]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim].[IsCurrent]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim].[IsCurrent]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim].[Email]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[Email]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim].[Source]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim].[Gender]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim].[FullName]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim].[FirstName]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim].[LastName]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim].[Email]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim].[SubTerritoryId]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim].[BUSINESSKEYHASH]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim].[HASHDATA]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim].[EffectiveDate]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim].[ExpirationDate]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim].[IsCurrent]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[Source]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[Gender]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[FullName]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[FirstName]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[LastName]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[ProdSubTerritoryId]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[HASHDATA]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[InsertedAt]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim].[UserId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[UserId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[stage].[Users].[UserId]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[Source]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[stage].[Users].[Source]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[Gender]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[stage].[Users].[Gender]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[FullName]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[stage].[Users].[FullName]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[FirstName]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[stage].[Users].[FirstName]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[LastName]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[stage].[Users].[LastName]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[Email]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[stage].[Users].[Email]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[InsertedAt]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[stage].[Users].[InsertedAt]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[SubTerritoryId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[stage].[Users].[SubTerritoryId]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[BUSINESSKEYHASH]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[stage].[Users].[BUSINESSKEYHASH]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[HASHDATA]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[stage].[Users].[HASHDATA]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[prod].[UpsertUsersDim].[#UsersWithProdSubTerritory].[ProdSubTerritoryId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[prod].[SubTerritoriesDim].[SubTerritoryId]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[prod]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="2432" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE PROCEDURE [prod].[UpsertUsersDim]&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlTable" Name="[prod].[UsersDim]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[UsersDim].[UserId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[UsersDim].[Source]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[UsersDim].[Gender]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="1" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[char]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[UsersDim].[FullName]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[UsersDim].[FirstName]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[UsersDim].[LastName]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[UsersDim].[Email]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="320" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[UsersDim].[SubTerritoryId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[UsersDim].[BUSINESSKEYHASH]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="6000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varbinary]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[UsersDim].[HASHDATA]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[UsersDim].[EffectiveDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[UsersDim].[ExpirationDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="7" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[prod].[UsersDim].[IsCurrent]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="8" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[prod]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="30" />
			<AttachedAnnotation Disambiguator="48" />
		</Element>
		<Element Type="SqlSchema" Name="[raw]">
			<Relationship Name="Authorizer">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlProcedure" Name="[raw].[IngestRawProducts]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
    SET NOCOUNT ON;

    IF OBJECT_ID('[raw].[Products]', 'U') IS NULL
    BEGIN
        CREATE TABLE [raw].[Products] (
            ProductId INT IDENTITY(1,1) PRIMARY KEY,
            Name NVARCHAR(255) NOT NULL,
            Description NVARCHAR(MAX) NULL,
            Color NVARCHAR(50) NULL,
            Brand NVARCHAR(100) NULL,
            Category NVARCHAR(100) NULL,
            Gender NVARCHAR(50) NULL,
            Price DECIMAL(10, 2) NOT NULL,
            InsertedAt DATETIME DEFAULT GETDATE()
        );
    END

    INSERT INTO [raw].[Products] (Name, Description, Color, Brand, Category, Gender, Price)
    VALUES (@Name, @Description, @Color, @Brand, @Category, @Gender, @Price);
END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[raw].[Products]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[ProductId]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Name]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Description]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Color]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Brand]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Category]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Gender]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Price]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[decimal]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[InsertedAt]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetime]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Name]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Description]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Color]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Brand]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Category]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Gender]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Price]" />
				</Entry>
				<Entry>
					<References Name="[raw].[IngestRawProducts].[@Name]" />
				</Entry>
				<Entry>
					<References Name="[raw].[IngestRawProducts].[@Description]" />
				</Entry>
				<Entry>
					<References Name="[raw].[IngestRawProducts].[@Color]" />
				</Entry>
				<Entry>
					<References Name="[raw].[IngestRawProducts].[@Brand]" />
				</Entry>
				<Entry>
					<References Name="[raw].[IngestRawProducts].[@Category]" />
				</Entry>
				<Entry>
					<References Name="[raw].[IngestRawProducts].[@Gender]" />
				</Entry>
				<Entry>
					<References Name="[raw].[IngestRawProducts].[@Price]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[raw].[IngestRawProducts].[@Name]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[raw].[IngestRawProducts].[@Description]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[raw].[IngestRawProducts].[@Color]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[raw].[IngestRawProducts].[@Brand]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[raw].[IngestRawProducts].[@Category]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[raw].[IngestRawProducts].[@Gender]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[raw].[IngestRawProducts].[@Price]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="2" />
									<Property Name="Precision" Value="10" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[raw]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="971" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE   PROCEDURE [raw].[IngestRawProducts]&#xD;&#xA;    @Name NVARCHAR(255),&#xD;&#xA;    @Description NVARCHAR(MAX),&#xD;&#xA;    @Color NVARCHAR(50),&#xD;&#xA;    @Brand NVARCHAR(100),&#xD;&#xA;    @Category NVARCHAR(100),&#xD;&#xA;    @Gender NVARCHAR(50),&#xD;&#xA;    @Price DECIMAL(10, 2)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[raw].[IngestRawTransactions]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
    SET NOCOUNT ON;

    IF OBJECT_ID('[raw].[Transactions]', 'U') IS NULL
    BEGIN
		CREATE TABLE [raw].[Transactions] (
			[TransactionId] INT IDENTITY(1,1),
			[TransactionJson] NVARCHAR(MAX),
			[InsertedAt] DATETIME DEFAULT GETDATE()
		);
    END

    INSERT INTO [raw].[Transactions] (TransactionJson)
    VALUES (@TransactionJson);
END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[raw].[Transactions]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Transactions].[TransactionId]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Transactions].[TransactionJson]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Transactions].[InsertedAt]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetime]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Transactions]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Transactions].[TransactionJson]" />
				</Entry>
				<Entry>
					<References Name="[raw].[IngestRawTransactions].[@TransactionJson]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[raw].[IngestRawTransactions].[@TransactionJson]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[raw]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="451" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [raw].[IngestRawTransactions]&#xD;&#xA;    @TransactionJson NVARCHAR(MAX)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[raw].[IngestRawUsers]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
    SET NOCOUNT ON;

    IF OBJECT_ID('[raw].[Users]', 'U') IS NULL
    BEGIN
        CREATE TABLE [raw].[Users]
        (
            [UserId] INT IDENTITY(1,1) PRIMARY KEY,
            [Source] NVARCHAR(255) NULL DEFAULT 'https://randomuser.me/api/',
            [UserJson] NVARCHAR(MAX) NOT NULL,
			[InsertedAt] DATETIME DEFAULT GETDATE()
        );

    END

    INSERT INTO [raw].[Users] (UserJson, Source)
    VALUES (@UserJson, @Source);
END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[raw].[Users]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Users].[UserId]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Users].[Source]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Users].[UserJson]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Users].[InsertedAt]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetime]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Users]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Users].[UserJson]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Users].[Source]" />
				</Entry>
				<Entry>
					<References Name="[raw].[IngestRawUsers].[@UserJson]" />
				</Entry>
				<Entry>
					<References Name="[raw].[IngestRawUsers].[@Source]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[raw].[IngestRawUsers].[@UserJson]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[raw].[IngestRawUsers].[@Source]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA['https://randomuser.me/api/']]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[raw]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="605" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [raw].[IngestRawUsers]&#xD;&#xA;    @UserJson NVARCHAR(MAX),&#xD;&#xA;    @Source NVARCHAR(255) = 'https://randomuser.me/api/'&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlTable" Name="[raw].[Products]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[raw].[Products].[ProductId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[raw].[Products].[Name]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[raw].[Products].[Description]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[raw].[Products].[Color]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[raw].[Products].[Brand]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[raw].[Products].[Category]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[raw].[Products].[Gender]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[raw].[Products].[Price]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="2" />
									<Property Name="Precision" Value="10" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[raw].[Products].[InsertedAt]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="4" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[raw]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="27" />
		</Element>
		<Element Type="SqlTable" Name="[raw].[Transactions]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[raw].[Transactions].[TransactionId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[raw].[Transactions].[TransactionJson]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[raw].[Transactions].[InsertedAt]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="18" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[raw]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[raw].[Users]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[raw].[Users].[UserId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[raw].[Users].[Source]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="16" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[raw].[Users].[UserJson]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[raw].[Users].[InsertedAt]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="17" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[raw]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="38" />
		</Element>
		<Element Type="SqlSchema" Name="[stage]">
			<Relationship Name="Authorizer">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[stage].[FK_StageTransactions_DateKey]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[stage].[Transactions].[DateKey]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[stage].[Transactions]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[prod].[DateDim].[DateKey]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[prod].[DateDim]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="49" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[stage].[FK_StageTransactions_ExchangeRateId]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[stage].[Transactions].[ExchangeRateId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[stage].[Transactions]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[prod].[ExchangeRatesDim].[ExchangeRateId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[prod].[ExchangeRatesDim]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="50" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[stage].[FK_StageTransactions_ProductId]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[stage].[Transactions].[ProductId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[stage].[Transactions]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[prod].[ProductsDim].[ProductId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[prod].[ProductsDim]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="51" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[stage].[FK_StageTransactions_UserId]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[stage].[Transactions].[UserId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[stage].[Transactions]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[prod].[UsersDim].[UserId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[prod].[UsersDim]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="52" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[stage].[FK_StageUsers_SubTerritories]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[stage].[Users].[SubTerritoryId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[stage].[Users]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[stage].[SubTerritories].[SubTerritoryId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[stage].[SubTerritories]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="53" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[stage].[FK_SubTerritories_Territories]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[stage].[SubTerritories].[TerritoryId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[stage].[SubTerritories]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[stage].[Territories].[TerritoryId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[stage].[Territories]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="54" />
		</Element>
		<Element Type="SqlProcedure" Name="[stage].[ProcessRawProducts]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
    SET NOCOUNT ON;

    BEGIN TRY
        BEGIN TRANSACTION;

        -- Step 1: Create the stage.Products table if it does not exist
        IF OBJECT_ID('[stage].[Products]', 'U') IS NULL
        BEGIN
            CREATE TABLE [stage].[Products] (
                ProductId INT IDENTITY(1,1) PRIMARY KEY,
                Name NVARCHAR(255) NOT NULL,
                Description NVARCHAR(MAX) NULL,
                Color NVARCHAR(50) NULL,
                Brand NVARCHAR(100) NULL,
                Category NVARCHAR(100) NULL,
                Gender NVARCHAR(50) NULL,
                Price DECIMAL(10, 2) NOT NULL,
                InsertedAt DATETIME DEFAULT GETDATE(),
                BUSINESSKEYHASH VARBINARY(6000) NULL,
                HASHDATA VARCHAR(MAX) NULL
            );
        END
        ELSE
        BEGIN
            -- Step 2: Truncate existing stage table
            TRUNCATE TABLE [stage].[Products];
        END

        INSERT INTO [stage].[Products] (
			Name,
			Description,
			Color,
			Brand,
			Category,
			Gender,
			Price
		)
		SELECT
			r.[Name],
			r.[Description],
			r.Color,
			r.Brand,
			r.Category,
			r.Gender,
			r.Price
		FROM 
			[raw].[Products] r
		WHERE NOT EXISTS (
			SELECT 1
			FROM 
				[stage].[Products] s
			WHERE s.Name = r.Name
				AND s.Brand = r.Brand
				AND s.Category = r.Category
				AND s.Color = r.Color
				AND s.Gender = r.Gender
				AND s.Price = r.Price
		);

        -- Step 4: Call hashing stored procedure
        EXEC config.HashTableEntries @DataSourceId = 5;

        COMMIT TRANSACTION;
    END TRY
    BEGIN CATCH
        ROLLBACK TRANSACTION;

        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();
        DECLARE @ErrorState INT = ERROR_STATE();

        RAISERROR (@ErrorMessage, @ErrorSeverity, @ErrorState);
    END CATCH
END;]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[ProductId]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Name]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Description]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Color]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Brand]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Category]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Gender]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Price]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[decimal]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[InsertedAt]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetime]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[BUSINESSKEYHASH]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varbinary]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[HASHDATA]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Name]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Description]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Color]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Brand]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Category]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Gender]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Price]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Name]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Description]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Color]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Brand]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Category]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Gender]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Price]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Name]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Name]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Brand]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Brand]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Category]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Category]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Color]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Color]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Gender]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Gender]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Products].[Price]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Products].[Price]" />
				</Entry>
				<Entry>
					<References Name="[config].[HashTableEntries]" />
				</Entry>
				<Entry>
					<References Name="[config].[HashTableEntries].[@DataSourceID]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[stage]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="2005" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [stage].[ProcessRawProducts]&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[stage].[ProcessRawTransactions]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
    SET NOCOUNT ON;

    BEGIN TRY
		TRUNCATE TABLE [stage].[Transactions];

        DECLARE 
            @TransactionId INT,
            @TransactionJson NVARCHAR(MAX),
            @InsertedAt DATETIME,
            @UserEmail NVARCHAR(320),
            @TransactionDate DATE,
            @Country NVARCHAR(100),
            @Cart NVARCHAR(MAX),

            @ProductName NVARCHAR(255),
            @ProductLocalPrice DECIMAL(18,2),
            @UserId INT,
            @ProductId INT,
            @CurrencyCode NVARCHAR(10),
            @ExchangeRateToEUR DECIMAL(18,6),
            @ExchangeRateId INT,
            @DateKey INT,

            @CartLocalTotal DECIMAL(18,2),
            @CartStandardizedTotal DECIMAL(18,2),

            @TransactionBK NVARCHAR(50),
            @TransactionDateStr NVARCHAR(8),
            @NextSequence INT = NULL;

        DECLARE TransactionCursor CURSOR FOR
            SELECT TransactionId, TransactionJson, InsertedAt
            FROM raw.Transactions
            ORDER BY InsertedAt;

        OPEN TransactionCursor;
        FETCH NEXT FROM TransactionCursor INTO @TransactionId, @TransactionJson, @InsertedAt;

		SET @TransactionDateStr = FORMAT(@TransactionDate, 'yyyyMMdd');

		SELECT @NextSequence = ISNULL(MAX(CAST(RIGHT(TransactionBK, 5) AS INT)), 0)
		FROM prod.TransactionsFact
		WHERE TransactionBK LIKE CONCAT('ORD', @TransactionDateStr, '%');

		DECLARE @CartItems TABLE (
            ProductName NVARCHAR(255),
            ProductLocalPrice DECIMAL(18,2)
        );

        WHILE @@FETCH_STATUS = 0
        BEGIN
			DELETE FROM @CartItems;

            SET @CartLocalTotal = 0;
            SET @CartStandardizedTotal = 0;

            SET @UserEmail = JSON_VALUE(@TransactionJson, '$.UserEmail');
            SET @TransactionDate = TRY_CAST(JSON_VALUE(@TransactionJson, '$.Date') AS DATE);
            SET @Cart = JSON_QUERY(@TransactionJson, '$.Cart');

            IF @UserEmail IS NULL OR @TransactionDate IS NULL
            BEGIN
                FETCH NEXT FROM TransactionCursor INTO @TransactionId, @TransactionJson, @InsertedAt;
                CONTINUE;
            END

            SELECT @Country = JSON_VALUE(TransactionJson, '$.Country')
            FROM raw.Transactions
            WHERE TransactionId = @TransactionId;

            SELECT @UserId = UserId
            FROM prod.UsersDim
            WHERE Email COLLATE SQL_Latin1_General_CP1_CI_AS = @UserEmail COLLATE SQL_Latin1_General_CP1_CI_AS
              AND IsCurrent = 1;

            IF @UserId IS NULL
            BEGIN
                FETCH NEXT FROM TransactionCursor INTO @TransactionId, @TransactionJson, @InsertedAt;
                CONTINUE;
            END

            SELECT @CurrencyCode = Currency
            FROM config.CountryInfo
            WHERE CountryName = @Country;

            IF @CurrencyCode IS NULL
            BEGIN
                FETCH NEXT FROM TransactionCursor INTO @TransactionId, @TransactionJson, @InsertedAt;
                CONTINUE;
            END

            -- Get latest exchange rate info
            SELECT TOP 1 
                @ExchangeRateToEUR = RateToEUR,
                @ExchangeRateId = ExchangeRateId
            FROM prod.ExchangeRatesDim
            WHERE Currency = @CurrencyCode AND IsCurrent = 1;

            IF @ExchangeRateToEUR IS NULL OR @ExchangeRateToEUR = 0
            BEGIN
                FETCH NEXT FROM TransactionCursor INTO @TransactionId, @TransactionJson, @InsertedAt;
                CONTINUE;
            END

            -- Get DateKey
            SELECT @DateKey = DateKey
            FROM prod.DateDim
            WHERE FullDate = @TransactionDate;

            IF @DateKey IS NULL
            BEGIN
                FETCH NEXT FROM TransactionCursor INTO @TransactionId, @TransactionJson, @InsertedAt;
                CONTINUE;
            END

			SET @NextSequence += 1;

			SET @TransactionBK = CONCAT('ORD', @TransactionDateStr, '-', RIGHT('00000' + CAST(@NextSequence AS NVARCHAR(5)), 5));

            INSERT INTO @CartItems(ProductName, ProductLocalPrice)
            SELECT 
                cart_key_value.[key],
                TRY_CAST(cart_key_value.[value] AS DECIMAL(18,2))
            FROM (SELECT @TransactionJson AS TransactionJson) AS r
            CROSS APPLY OPENJSON(r.TransactionJson, '$.Cart') AS cart_item
            CROSS APPLY OPENJSON(cart_item.value) AS cart_key_value;

            DECLARE CartCursor CURSOR FOR
                SELECT ProductName, ProductLocalPrice FROM @CartItems;

            OPEN CartCursor;
            FETCH NEXT FROM CartCursor INTO @ProductName, @ProductLocalPrice;

            WHILE @@FETCH_STATUS = 0
            BEGIN
                SELECT @ProductId = ProductId
                FROM prod.ProductsDim
                WHERE Name = @ProductName AND @ProductLocalPrice = Price AND IsCurrent = 1;

                IF @ProductId IS NULL
                BEGIN
                    FETCH NEXT FROM CartCursor INTO @ProductName, @ProductLocalPrice;
                    CONTINUE;
                END

                DECLARE @ProductStandardizedPrice DECIMAL(18,2) = ROUND(ISNULL(@ProductLocalPrice,0) * NULLIF(@ExchangeRateToEUR,0), 2);

                SET @CartLocalTotal += ISNULL(@ProductLocalPrice, 0);
                SET @CartStandardizedTotal += @ProductStandardizedPrice;

                INSERT INTO stage.Transactions (
                    TransactionBK,
                    UserId,
                    Currency,
                    ProductId,
                    ProductLocalPrice,
                    ProductStandardizedPrice,
                    CartLocalPrice,
                    CartStandardizedPrice,
                    ExchangeRateId,
                    DateKey,
                    InsertedAt
                )
                VALUES (
                    @TransactionBK,
                    @UserId,
                    @CurrencyCode,
                    @ProductId,
                    @ProductLocalPrice,
                    @ProductStandardizedPrice,
                    0,
                    0,
                    @ExchangeRateId,
                    @DateKey,
                    @InsertedAt
                );

                FETCH NEXT FROM CartCursor INTO @ProductName, @ProductLocalPrice;
            END

            CLOSE CartCursor;
            DEALLOCATE CartCursor;

            UPDATE stage.Transactions
            SET CartLocalPrice = @CartLocalTotal,
                CartStandardizedPrice = @CartStandardizedTotal
            WHERE TransactionBK = @TransactionBK;

            FETCH NEXT FROM TransactionCursor INTO @TransactionId, @TransactionJson, @InsertedAt;
        END

        CLOSE TransactionCursor;
        DEALLOCATE TransactionCursor;

    END TRY
    BEGIN CATCH
        DECLARE @ErrorMessage NVARCHAR(4000) = ERROR_MESSAGE();
        RAISERROR('Error in stage.ProcessRawTransactions: %s', 16, 1, @ErrorMessage);
    END CATCH;
END;]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetime]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[date]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[decimal]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[decimal]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[decimal]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[decimal]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[decimal]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Transactions]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Transactions].[TransactionId]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Transactions].[TransactionJson]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Transactions].[InsertedAt]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TransactionsFact]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TransactionsFact].[TransactionBK]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim].[UserId]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim].[Email]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UsersDim].[IsCurrent]" />
				</Entry>
				<Entry>
					<References Name="[config].[CountryInfo]" />
				</Entry>
				<Entry>
					<References Name="[config].[CountryInfo].[Currency]" />
				</Entry>
				<Entry>
					<References Name="[config].[CountryInfo].[CountryName]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ExchangeRatesDim]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ExchangeRatesDim].[RateToEUR]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ExchangeRatesDim].[ExchangeRateId]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ExchangeRatesDim].[Currency]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ExchangeRatesDim].[IsCurrent]" />
				</Entry>
				<Entry>
					<References Name="[prod].[DateDim]" />
				</Entry>
				<Entry>
					<References Name="[prod].[DateDim].[DateKey]" />
				</Entry>
				<Entry>
					<References Name="[prod].[DateDim].[FullDate]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawTransactions].[@CartItems].[ProductName]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawTransactions].[@CartItems].[ProductLocalPrice]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim].[ProductId]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim].[Name]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim].[Price]" />
				</Entry>
				<Entry>
					<References Name="[prod].[ProductsDim].[IsCurrent]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions].[TransactionBK]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions].[UserId]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions].[Currency]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions].[ProductId]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions].[ProductLocalPrice]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions].[ProductStandardizedPrice]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions].[CartLocalPrice]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions].[CartStandardizedPrice]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions].[ExchangeRateId]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions].[DateKey]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Transactions].[InsertedAt]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[stage].[ProcessRawTransactions].[@CartItems]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[stage].[ProcessRawTransactions].[@CartItems].[ProductName]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="255" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[nvarchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[stage].[ProcessRawTransactions].[@CartItems].[ProductLocalPrice]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Scale" Value="2" />
												<Property Name="Precision" Value="18" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[decimal]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[stage]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="7214" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE   PROCEDURE [stage].[ProcessRawTransactions]&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[stage].[ProcessRawUsers]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
    SET NOCOUNT ON;

    DECLARE @TerritorySuccess BIT, @TerritoryError NVARCHAR(MAX);
    DECLARE @SubTerritorySuccess BIT, @SubTerritoryError NVARCHAR(MAX);

    BEGIN TRY
        BEGIN TRANSACTION;

		TRUNCATE TABLE [stage].[Users];

        IF OBJECT_ID('tempdb..#ParsedUsers') IS NOT NULL DROP TABLE #ParsedUsers;

        CREATE TABLE #ParsedUsers (
            Source NVARCHAR(255),
            Gender CHAR(1),
            FullName NVARCHAR(255),
            FirstName NVARCHAR(100),
            LastName NVARCHAR(100),
            Email NVARCHAR(320),
            Country NVARCHAR(100),
            State NVARCHAR(100),
            City NVARCHAR(100),
            StreetName NVARCHAR(255),
            Latitude DECIMAL(9,6) NULL,
            Longitude DECIMAL(9,6) NULL,
            InsertedAt DATETIME
        );

        INSERT INTO #ParsedUsers (
            Source, Gender, FullName, FirstName, LastName, Email,
            Country, State, City, StreetName, Latitude, Longitude, InsertedAt
        )
        SELECT
            u.Source,
            CASE LOWER(JSON_VALUE(u.UserJson, '$.gender'))
                WHEN 'male' THEN 'M'
                WHEN 'female' THEN 'F'
                ELSE NULL
            END,
            JSON_VALUE(u.UserJson, '$.name.first') + ' ' + JSON_VALUE(u.UserJson, '$.name.last'),
            JSON_VALUE(u.UserJson, '$.name.first'),
            JSON_VALUE(u.UserJson, '$.name.last'),
            JSON_VALUE(u.UserJson, '$.email'),
            JSON_VALUE(u.UserJson, '$.location.country'),
            JSON_VALUE(u.UserJson, '$.location.state'),
            JSON_VALUE(u.UserJson, '$.location.city'),
            JSON_VALUE(u.UserJson, '$.location.street.name'),
            TRY_CAST(JSON_VALUE(u.UserJson, '$.location.coordinates.latitude') AS DECIMAL(9,6)),
            TRY_CAST(JSON_VALUE(u.UserJson, '$.location.coordinates.longitude') AS DECIMAL(9,6)),
            u.InsertedAt
        FROM raw.Users u
        WHERE 
            ISNULL(JSON_VALUE(u.UserJson, '$.name.first'), '') COLLATE Latin1_General_BIN NOT LIKE '%[^ -~]%' AND
            ISNULL(JSON_VALUE(u.UserJson, '$.name.last'), '') COLLATE Latin1_General_BIN NOT LIKE '%[^ -~]%' AND
            ISNULL(JSON_VALUE(u.UserJson, '$.location.city'), '') COLLATE Latin1_General_BIN NOT LIKE '%[^ -~]%' AND
            ISNULL(JSON_VALUE(u.UserJson, '$.location.state'), '') COLLATE Latin1_General_BIN NOT LIKE '%[^ -~]%';

		DELETE FROM stage.SubTerritories;
		DELETE FROM stage.Territories;


        -- Process Territories
        EXEC [stage].[ProcessTerritories]
            @IsSuccess = @TerritorySuccess OUTPUT,
            @ErrorMessage = @TerritoryError OUTPUT;

        IF @TerritorySuccess = 0
        BEGIN
            RAISERROR(@TerritoryError, 16, 1);
        END

        -- Process SubTerritories
        EXEC [stage].[ProcessSubTerritories]
            @IsSuccess = @SubTerritorySuccess OUTPUT,
            @ErrorMessage = @SubTerritoryError OUTPUT;

        IF @SubTerritorySuccess = 0
        BEGIN
            RAISERROR(@SubTerritoryError, 16, 1);
        END

        -- Final user load
        INSERT INTO stage.Users (
            Source, Gender, FullName, FirstName, LastName, Email, InsertedAt, SubTerritoryId
        )
        SELECT
            pu.Source,
            pu.Gender,
            pu.FullName,
            pu.FirstName,
            pu.LastName,
            pu.Email,
            pu.InsertedAt,
            st.SubTerritoryId
        FROM #ParsedUsers pu
        INNER JOIN stage.Territories t
            ON pu.Country = t.Country AND pu.State = t.State
        INNER JOIN stage.SubTerritories st
            ON t.TerritoryId = st.TerritoryId
           AND st.City = pu.City
           AND ISNULL(st.StreetName, '') = ISNULL(pu.StreetName, '')
           AND ISNULL(st.Latitude, 0) = ISNULL(pu.Latitude, 0)
           AND ISNULL(st.Longitude, 0) = ISNULL(pu.Longitude, 0);

        EXEC config.HashTableEntries @DataSourceId = 1;

		EXEC prod.UpsertUsersDim;

        COMMIT TRANSACTION;
    END TRY
    BEGIN CATCH
        ROLLBACK TRANSACTION;
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();
        DECLARE @ErrorState INT = ERROR_STATE();
        RAISERROR (@ErrorMessage, @ErrorSeverity, @ErrorState);
    END CATCH
END;]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bit]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bit]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Users]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[Source]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[Gender]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[FullName]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[FirstName]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[LastName]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[Email]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[Country]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[State]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[City]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[StreetName]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[Latitude]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[Longitude]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[InsertedAt]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Users]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Users].[Source]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Users].[UserJson]" />
				</Entry>
				<Entry>
					<References Name="[raw].[Users].[InsertedAt]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Territories]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessTerritories]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessTerritories].[@IsSuccess]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessTerritories].[@ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessSubTerritories]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessSubTerritories].[@IsSuccess]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessSubTerritories].[@ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Users].[Source]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Users].[Gender]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Users].[FullName]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Users].[FirstName]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Users].[LastName]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Users].[Email]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Users].[InsertedAt]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Users].[SubTerritoryId]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[Country]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Territories].[Country]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[State]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Territories].[State]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Territories].[TerritoryId]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[TerritoryId]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[City]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[City]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[StreetName]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[StreetName]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[Latitude]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[Latitude]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[Longitude]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[Longitude]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[Source]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[Gender]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[FullName]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[FirstName]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[LastName]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[Email]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessRawUsers].[#ParsedUsers].[InsertedAt]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[SubTerritoryId]" />
				</Entry>
				<Entry>
					<References Name="[config].[HashTableEntries]" />
				</Entry>
				<Entry>
					<References Name="[config].[HashTableEntries].[@DataSourceID]" />
				</Entry>
				<Entry>
					<References Name="[prod].[UpsertUsersDim]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[stage].[ProcessRawUsers].[#ParsedUsers]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[stage].[ProcessRawUsers].[#ParsedUsers].[Source]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="255" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[nvarchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[stage].[ProcessRawUsers].[#ParsedUsers].[Gender]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="1" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[char]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[stage].[ProcessRawUsers].[#ParsedUsers].[FullName]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="255" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[nvarchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[stage].[ProcessRawUsers].[#ParsedUsers].[FirstName]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="100" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[nvarchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[stage].[ProcessRawUsers].[#ParsedUsers].[LastName]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="100" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[nvarchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[stage].[ProcessRawUsers].[#ParsedUsers].[Email]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="320" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[nvarchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[stage].[ProcessRawUsers].[#ParsedUsers].[Country]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="100" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[nvarchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[stage].[ProcessRawUsers].[#ParsedUsers].[State]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="100" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[nvarchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[stage].[ProcessRawUsers].[#ParsedUsers].[City]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="100" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[nvarchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[stage].[ProcessRawUsers].[#ParsedUsers].[StreetName]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="255" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[nvarchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[stage].[ProcessRawUsers].[#ParsedUsers].[Latitude]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Scale" Value="6" />
												<Property Name="Precision" Value="9" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[decimal]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[stage].[ProcessRawUsers].[#ParsedUsers].[Longitude]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Scale" Value="6" />
												<Property Name="Precision" Value="9" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[decimal]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[stage].[ProcessRawUsers].[#ParsedUsers].[InsertedAt]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[datetime]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[stage]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="4" />
				<Property Name="Length" Value="4510" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;&#xD;&#xA;CREATE PROCEDURE [stage].[ProcessRawUsers]&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[stage].[ProcessSubTerritories]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
    SET NOCOUNT ON;

    BEGIN TRY
        -- Insert distinct subterritories
        INSERT INTO stage.SubTerritories (
            TerritoryId, City, StreetName, Latitude, Longitude
        )
        SELECT DISTINCT
            t.TerritoryId,
            pu.City,
            pu.StreetName,
            pu.Latitude,
            pu.Longitude
        FROM #ParsedUsers pu
        INNER JOIN stage.Territories t
            ON pu.Country = t.Country AND pu.State = t.State
        WHERE NOT EXISTS (
            SELECT 1
            FROM stage.SubTerritories st
            WHERE st.TerritoryId = t.TerritoryId
              AND st.City = pu.City
              AND ISNULL(st.StreetName, '') = ISNULL(pu.StreetName, '')
              AND ISNULL(st.Latitude, 0) = ISNULL(pu.Latitude, 0)
              AND ISNULL(st.Longitude, 0) = ISNULL(pu.Longitude, 0)
        );

		EXEC config.HashTableEntries @DataSourceId = 3;

		EXEC [prod].[MergeSubTerritoriesDim];

        SET @IsSuccess = 1;
        SET @ErrorMessage = NULL;
    END TRY
    BEGIN CATCH
        SET @IsSuccess = 0;
        SET @ErrorMessage = ERROR_MESSAGE();
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();
        DECLARE @ErrorState INT = ERROR_STATE();
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);
    END CATCH
END;]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[TerritoryId]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[City]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[StreetName]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[Latitude]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[Longitude]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[stage].[Territories]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[stage].[Territories].[Country]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[stage].[Territories].[State]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Territories].[TerritoryId]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[stage].[SubTerritories].[TerritoryId]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Territories].[TerritoryId]" />
				</Entry>
				<Entry>
					<References Name="[stage].[SubTerritories].[City]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[stage].[SubTerritories].[StreetName]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[stage].[SubTerritories].[Latitude]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[stage].[SubTerritories].[Longitude]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[config].[HashTableEntries]" />
				</Entry>
				<Entry>
					<References Name="[config].[HashTableEntries].[@DataSourceID]" />
				</Entry>
				<Entry>
					<References Name="[prod].[MergeSubTerritoriesDim]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessSubTerritories].[@IsSuccess]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessSubTerritories].[@ErrorMessage]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[stage].[ProcessSubTerritories].[@IsSuccess]">
						<Property Name="IsOutput" Value="True" />
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[stage].[ProcessSubTerritories].[@ErrorMessage]">
						<Property Name="IsOutput" Value="True" />
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[stage]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="1472" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [stage].[ProcessSubTerritories]&#xD;&#xA;    @IsSuccess BIT OUTPUT,&#xD;&#xA;    @ErrorMessage NVARCHAR(MAX) OUTPUT&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[stage].[ProcessTerritories]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
    SET NOCOUNT ON;

    BEGIN TRY
        -- Insert distinct values from #ParsedUsers
        INSERT INTO stage.Territories (Country, State)
        SELECT DISTINCT
            pu.Country,
            pu.State
        FROM #ParsedUsers pu
        WHERE NOT EXISTS (
            SELECT 1
            FROM stage.Territories t
            WHERE t.Country = pu.Country AND t.State = pu.State
        );

		EXEC config.HashTableEntries @DataSourceId = 2;

		EXEC [prod].[MergeTerritoriesDim];

        SET @IsSuccess = 1;
        SET @ErrorMessage = NULL;
    END TRY
    BEGIN CATCH
        SET @IsSuccess = 0;
        SET @ErrorMessage = ERROR_MESSAGE();
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();
        DECLARE @ErrorState INT = ERROR_STATE();
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);
    END CATCH
END;]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Territories]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Territories].[Country]" />
				</Entry>
				<Entry>
					<References Name="[stage].[Territories].[State]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[stage].[Territories].[Country]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[stage].[Territories].[State]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[config].[HashTableEntries]" />
				</Entry>
				<Entry>
					<References Name="[config].[HashTableEntries].[@DataSourceID]" />
				</Entry>
				<Entry>
					<References Name="[prod].[MergeTerritoriesDim]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessTerritories].[@IsSuccess]" />
				</Entry>
				<Entry>
					<References Name="[stage].[ProcessTerritories].[@ErrorMessage]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[stage].[ProcessTerritories].[@IsSuccess]">
						<Property Name="IsOutput" Value="True" />
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[stage].[ProcessTerritories].[@ErrorMessage]">
						<Property Name="IsOutput" Value="True" />
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[stage]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="993" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [stage].[ProcessTerritories]&#xD;&#xA;    @IsSuccess BIT OUTPUT,&#xD;&#xA;    @ErrorMessage NVARCHAR(MAX) OUTPUT&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlTable" Name="[stage].[Products]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Products].[ProductId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Products].[Name]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Products].[Description]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Products].[Color]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Products].[Brand]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Products].[Category]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Products].[Gender]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Products].[Price]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="2" />
									<Property Name="Precision" Value="10" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Products].[InsertedAt]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="3" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Products].[BUSINESSKEYHASH]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="6000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varbinary]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Products].[HASHDATA]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[stage]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="26" />
		</Element>
		<Element Type="SqlTable" Name="[stage].[SubTerritories]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[SubTerritories].[SubTerritoryId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[SubTerritories].[TerritoryId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[SubTerritories].[City]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[SubTerritories].[StreetName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[SubTerritories].[Latitude]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="6" />
									<Property Name="Precision" Value="9" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[SubTerritories].[Longitude]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="6" />
									<Property Name="Precision" Value="9" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[SubTerritories].[CreatedAt]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="19" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[SubTerritories].[BUSINESSKEYHASH]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="6000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varbinary]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[SubTerritories].[HASHDATA]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[stage]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="39" />
			<AttachedAnnotation Disambiguator="54" />
		</Element>
		<Element Type="SqlTable" Name="[stage].[Territories]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Territories].[TerritoryId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Territories].[Country]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Territories].[State]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Territories].[CreatedAt]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="20" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Territories].[BUSINESSKEYHASH]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="6000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varbinary]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Territories].[HASHDATA]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[stage]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="40" />
		</Element>
		<Element Type="SqlTable" Name="[stage].[Transactions]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Transactions].[TransactionId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Transactions].[TransactionBK]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Transactions].[UserId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Transactions].[Currency]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="3" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Transactions].[ProductId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Transactions].[ProductLocalPrice]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="2" />
									<Property Name="Precision" Value="18" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Transactions].[ProductStandardizedPrice]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="2" />
									<Property Name="Precision" Value="18" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Transactions].[CartLocalPrice]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="2" />
									<Property Name="Precision" Value="18" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Transactions].[CartStandardizedPrice]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Scale" Value="2" />
									<Property Name="Precision" Value="18" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[decimal]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Transactions].[ExchangeRateId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Transactions].[DateKey]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Transactions].[InsertedAt]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="5" />
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[stage]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="28" />
			<AttachedAnnotation Disambiguator="49" />
			<AttachedAnnotation Disambiguator="50" />
			<AttachedAnnotation Disambiguator="51" />
			<AttachedAnnotation Disambiguator="52" />
		</Element>
		<Element Type="SqlTable" Name="[stage].[Users]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Users].[UserId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Users].[Source]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="21" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Users].[Gender]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="1" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[char]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Users].[FullName]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Users].[FirstName]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Users].[LastName]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Users].[Email]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="320" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Users].[InsertedAt]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="22" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Users].[SubTerritoryId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Users].[BUSINESSKEYHASH]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="6000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varbinary]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[stage].[Users].[HASHDATA]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[stage]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="41" />
			<AttachedAnnotation Disambiguator="53" />
		</Element>
		<Element Type="SqlSchema" Name="[utils]">
			<Relationship Name="Authorizer">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlView" Name="[utils].[GetTerritoryCurrencies]">
			<Property Name="QueryScript">
				<Value><![CDATA[
SELECT DISTINCT
    td.Country [Country],
    ci.Currency [Currency]
FROM
    prod.TerritoriesDim td
JOIN config.CountryInfo ci 
	ON td.Country = ci.CountryName]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlComputedColumn" Name="[utils].[GetTerritoryCurrencies].[Country]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[prod].[TerritoriesDim].[Country]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[utils].[GetTerritoryCurrencies].[Currency]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[config].[CountryInfo].[Currency]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="QueryDependencies">
				<Entry>
					<References Name="[prod].[TerritoriesDim]" />
				</Entry>
				<Entry>
					<References Name="[config].[CountryInfo]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TerritoriesDim].[Country]" />
				</Entry>
				<Entry>
					<References Name="[config].[CountryInfo].[CountryName]" />
				</Entry>
				<Entry>
					<References Name="[prod].[TerritoriesDim].[Country]" />
				</Entry>
				<Entry>
					<References Name="[config].[CountryInfo].[Currency]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[utils]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="214" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE   VIEW utils.GetTerritoryCurrencies AS" />
				<Property Name="FooterContents" Value=";" />
			</Annotation>
		</Element>
	</Model>
</DataSchemaModel>